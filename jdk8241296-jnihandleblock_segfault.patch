# HG changeset patch
# User aph
# Date 1584629637 0
#      Thu Mar 19 14:53:57 2020 +0000
# Node ID e96597ea4d672793ab205fd67009efed809fae11
# Parent  0daa6b52ba568246e8f930138fb36f8f04d9fadd
8241296: Segfault in JNIHandleBlock::oops_do()
Reviewed-by: duke

diff --git openjdk.orig/hotspot/src/share/vm/runtime/thread.cpp openjdk/hotspot/src/share/vm/runtime/thread.cpp
--- openjdk.orig/hotspot/src/share/vm/runtime/thread.cpp
+++ openjdk/hotspot/src/share/vm/runtime/thread.cpp
@@ -836,7 +836,9 @@
 }
 
 void Thread::oops_do(OopClosure* f, CLDClosure* cld_f, CodeBlobClosure* cf) {
-  active_handles()->oops_do(f);
+  if (active_handles() != NULL) {
+    active_handles()->oops_do(f);
+  }
   // Do oop for ThreadShadow
   f->do_oop((oop*)&_pending_exception);
   handle_area()->oops_do(f);
